# 消费撤销接口

是指因人为原因而撤销已完成的消费，商户可以通过SDK向银联全渠道支付平台发起消费撤销交易，消费撤销必须是撤销CUPS当日当批的消费。发卡行批准的消费撤销金额将即时地反映到该持卡人的账户上。完成交易的过程不需要同持卡人交互，属于后台交易。

> 阅读本文之前请仔细阅读[手机支付控件 - 消费撤销接口](https://open.unionpay.com/tjweb/acproduct/APIList?apiservId=450&acpAPIId=766&bussType=0)

## 接口调用

返回结果自行验签

```php
$params = [
    'orderId' => date('YmdHis'), // 订单号
    'txnAmt' => 1, // 支付金额 单位为分
    'origQryId' => '', // 原交易查询流水号，可以从支付返回的数据中获取
];

$res = $app->order->cancel($params);

if ($app->signature->validate($res)) {
    echo "验签成功";
}else
{
    echo "验签失败";
}
```

## 更多参数

| 中文名称         | 英文名称    | 域类型         | 默认值 | 请求要求     | 备注                                                         |
| :--------------- | :---------- | :------------- | :----- | :----------- | :----------------------------------------------------------- |
| 版本号           | version     | NS5            | 无     | M-必填       | 固定填写                                                     |
| 编码方式         | encoding    | ANS1..20       | UTF-8  | M-必填       | 默认取值：UTF-8                                              |
| 产品类型         | bizType     | N6             | 无     | M-必填       |                                                              |
| 订单发送时间     | txnTime     | YYYYMMDDhhmmss | 无     | M-必填       |                                                              |
| 后台通知地址     | backUrl     | ANS1..256      | 无     | M-必填       | 后台返回商户结果时使用，如上送，则发送商户后台交易结果通知，不支持换行符等不可见字符，如需通过专线通知，需要在通知地址前面加上前缀：专线的首字母加竖线ZX\|如果不需要发后台通知，可以固定上送http://www.specialUrl.com |
| 交易金额         | txnAmt      | N1..12         | 无     | M-必填       | 与原消费交易一致                                             |
| 交易类型         | txnType     | N2             | 无     | M-必填       | 取值：31                                                     |
| 交易子类         | txnSubType  | N2             | 无     | M-必填       | 默认：00                                                     |
| 接入类型         | accessType  | N1             | 无     | M-必填       | 0：商户直连接入1：收单机构接入2：平台商户接入                |
| 签名             | signature   | ANS1..1024     | 0      | M-必填       | 填写对报文摘要的签名                                         |
| 签名方法         | signMethod  | N2             | 无     | M-必填       | 非对称签名： 01（表示采用RSA签名） HASH表示散列算法 11：支持散列方式验证SHA-256 12：支持散列方式验证SM3 |
| 渠道类型         | channelType | N2             | 无     | M-必填       |                                                              |
| 商户代码         | merId       | AN15           | 无     | M-必填       |                                                              |
| 商户订单号       | orderId     | AN8..40        | 无     | M-必填       | 商户订单号，不能含“-”或“_”;商户自定义，同一交易日期内不可重复;商户代码merId、商户订单号orderId、订单发送时间txnTime三要素唯一确定一笔交易。 |
| 原交易查询流水号 | origQryId   | AN21           | 无     | M-必填       | 原始消费交易的queryId                                        |
| 二级商户代码     | subMerId    | AN5..15        | 无     | C-按条件必填 | 商户类型为平台类商户接入时必须上送                           |
| 二级商户简称     | subMerAbbr  | ANS1…16        | 无     | C-按条件必填 | 商户类型为平台类商户接入时必须上送                           |
| 二级商户名称     | subMerName  | ANS1..40       | 无     | C-按条件必填 | 商户类型为平台类商户接入时必须上送                           |
| 证书ID           | certId      | N1..128        | 无     | C-按条件必填 |                                                              |
| 保留域           | reserved    | ANS1..2048     | 无     | O-选填       |                             |
| 请求方保留域     | reqReserved | ANS1..1024     | 无     | O-选填       | 商户自定义保留域，交易应答时会原样返回                       |
| 终端号           | termId      | ANS8           | 无     | O-选填       |                                                              |

## 返回结果

| 中文名称         | 英文名称       | 域类型         | 默认值 | 请求要求     | 备注                                                         |
| :--------------- | :------------- | :------------- | :----- | :----------- | :----------------------------------------------------------- |
| 查询流水号       | queryId        | AN20..21       | 无     | M-必填       | 消费撤销交易的交易流水号供查询用                             |
| 签名             | signature      | ANS1..1024     | 0      | M-必填       |                                                              |
| 签名方法         | signMethod     | N2             | 无     | M-必填       |                                                              |
| 应答码           | respCode       | AN2            | 无     | M-必填       |                                                              |
| 应答信息         | respMsg        | ANS1..256      | 无     | M-必填       |                                                              |
| 签名公钥证书     | signPubKeyCert | AN1..2048      | 无     | C-按条件必填 | 此域填写银联签名公钥证书，使用RSA签名方式时，默认返回，如果ctrlRule第五位为1时，不返。 |
| 版本号           | version        | NS5            | 无     | R-需要返回   |                                                              |
| 编码方式         | encoding       | ANS1..20       | UTF-8  | R-需要返回   |                                                              |
| 产品类型         | bizType        | N6             | 无     | R-需要返回   |                                                              |
| 订单发送时间     | txnTime        | YYYYMMDDhhmmss | 无     | R-需要返回   |                                                              |
| 交易金额         | txnAmt         | N1..12         | 无     | R-需要返回   |                                                              |
| 交易类型         | txnType        | N2             | 无     | R-需要返回   |                                                              |
| 交易子类         | txnSubType     | N2             | 无     | R-需要返回   |                                                              |
| 接入类型         | accessType     | N1             | 无     | R-需要返回   | 0：商户直连接入1：收单机构接入2：平台商户接入                |
| 请求方保留域     | reqReserved    | ANS1..1024     | 无     | R-需要返回   |                                                              |
| 商户代码         | merId          | AN15           | 无     | R-需要返回   |                                                              |
| 商户订单号       | orderId        | AN8..40        | 无     | R-需要返回   | 商户订单号，不能含“-”或“_”;商户自定义，同一交易日期内不可重复;商户代码merId、商户订单号orderId、订单发送时间txnTime三要素唯一确定一笔交易。 |
| 原交易查询流水号 | origQryId      | AN21           | 无     | R-需要返回   | 原始消费交易的queryId                                        |
| 保留域           | reserved       | ANS1..2048     | 无     | O-选填       |                             |

## 异步通知

| 中文名称         | 英文名称           | 域类型         | 默认值 | 请求要求     | 备注                                                         |
| :--------------- | :----------------- | :------------- | :----- | :----------- | :----------------------------------------------------------- |
| 查询流水号       | queryId            | AN20..21       | 无     | M-必填       | 消费撤销交易的交易流水号 供查询用                            |
| 交易币种         | currencyCode       | AN3            | 无     | M-必填       |                                                              |
| 交易传输时间     | traceTime          | MMDDhhmmss     | 无     | M-必填       |                                                              |
| 签名             | signature          | ANS1..1024     | 0      | M-必填       |                                                              |
| 签名方法         | signMethod         | N2             | 无     | M-必填       |                                                              |
| 清算币种         | settleCurrencyCode | AN3            | 无     | M-必填       |                                                              |
| 清算金额         | settleAmt          | N1..12         | 无     | M-必填       |                                                              |
| 清算日期         | settleDate         | MMDD           | 无     | M-必填       |                                                              |
| 系统跟踪号       | traceNo            | N6             | 无     | M-必填       |                                                              |
| 应答码           | respCode           | AN2            | 无     | M-必填       |                                                              |
| 应答信息         | respMsg            | ANS1..256      | 无     | M-必填       |                                                              |
| 兑换日期         | exchangeDate       | MMDD           | 无     | C-按条件必填 | 交易成功，交易币种和清算币种不一致的时候返回                 |
| 签名公钥证书     | signPubKeyCert     | AN1..2048      | 无     | C-按条件必填 | 此域填写银联签名公钥证书，使用RSA签名方式时，默认返回，如果ctrlRule第五位为1时，不返。 |
| 清算汇率         | exchangeRate       | N8             | 无     | C-按条件必填 | 交易成功，交易币种和清算币种不一致的时候返回                 |
| 版本号           | version            | NS5            | 无     | R-需要返回   |                                                              |
| 编码方式         | encoding           | ANS1..20       | UTF-8  | R-需要返回   |                                                              |
| 产品类型         | bizType            | N6             | 无     | R-需要返回   |                                                              |
| 订单发送时间     | txnTime            | YYYYMMDDhhmmss | 无     | R-需要返回   |                                                              |
| 交易金额         | txnAmt             | N1..12         | 无     | R-需要返回   |                                                              |
| 交易类型         | txnType            | N2             | 无     | R-需要返回   |                                                              |
| 交易子类         | txnSubType         | N2             | 无     | R-需要返回   |                                                              |
| 接入类型         | accessType         | N1             | 无     | R-需要返回   | 0：商户直连接入1：收单机构接入2：平台商户接入                |
| 请求方保留域     | reqReserved        | ANS1..1024     | 无     | R-需要返回   |                                                              |
| 商户代码         | merId              | AN15           | 无     | R-需要返回   |                                                              |
| 商户订单号       | orderId            | AN8..40        | 无     | R-需要返回   | 商户订单号，不能含“-”或“_”;商户自定义，同一交易日期内不可重复;商户代码merId、商户订单号orderId、订单发送时间txnTime三要素唯一确定一笔交易。 |
| 原交易查询流水号 | origQryId          | AN21           | 无     | R-需要返回   | 原始消费交易的queryId                                        |
| 保留域           | reserved           | ANS1..2048     | 无     | O-选填       |                              |

# 交易状态查询接口

该接口提供所有银联订单的查询，包括支付、退货、消费撤销交易。商户可以通过查询订单接口主动查询订单状态，完成下一步的业务逻辑。

> 阅读本文之前请仔细阅读[手机支付控件 - 交易状态查询接口](https://open.unionpay.com/tjweb/acproduct/APIList?acpAPIId=768&apiservId=450&version=V2.2&bussType=0)

## 接口调用

返回结果自行验签

```php
$params = [
    'orderId' => date('YmdHis'), // 订单号
];

$res = $app->order->query($params);

if ($app->signature->validate($res)) {
    echo "验签成功";
}else
{
    echo "验签失败";
}
```

## 更多参数

| 中文名称     | 英文名称   | 域类型         | 默认值 | 请求要求     | 备注                                                         |
| :----------- | :--------- | :------------- | :----- | :----------- | :----------------------------------------------------------- |
| 版本号       | version    | NS5            | 无     | M-必填       | 固定填写                                                     |
| 编码方式     | encoding   | ANS1..20       | UTF-8  | M-必填       | 默认取值：UTF-8                                              |
| 产品类型     | bizType    | N6             | 无     | M-必填       | 000802                                                       |
| 订单发送时间 | txnTime    | YYYYMMDDhhmmss | 无     | M-必填       | 被查询交易的交易时间                                         |
| 交易类型     | txnType    | N2             | 无     | M-必填       | 交易类型：00                                                 |
| 交易子类     | txnSubType | N2             | 无     | M-必填       | 默认：00                                                     |
| 接入类型     | accessType | N1             | 无     | M-必填       | 0：商户直连接入1：收单机构接入2：平台商户接入                |
| 签名         | signature  | ANS1..1024     | 0      | M-必填       | 填写对报文摘要的签名                                         |
| 签名方法     | signMethod | N2             | 无     | M-必填       | 非对称签名： 01（表示采用RSA签名） HASH表示散列算法 11：支持散列方式验证SHA-256 12：支持散列方式验证SM3 |
| 商户代码     | merId      | AN15           | 无     | M-必填       |                                                              |
| 商户订单号   | orderId    | AN8..40        | 无     | M-必填       | 商户订单号，不能含“-”或“_”;商户自定义，同一交易日期内不可重复;商户代码merId、商户订单号orderId、订单发送时间txnTime三要素唯一确定一笔交易。 |
| 商户简称     | merAbbr    | ANS1..8        | 无     | C-按条件必填 | 接入类型为收单机构接入时需上送                               |
| 商户类别     | merCatCode | N4             | 无     | C-按条件必填 | 接入类型为收单机构接入时需上送                               |
| 商户名称     | merName    | ANS1..40       | 无     | C-按条件必填 | 接入类型为收单机构接入时需上送                               |
| 收单机构代码 | acqInsCode | AN8..11        | 无     | C-按条件必填 | 接入类型为收单机构接入时需上送                               |
| 证书ID       | certId     | N1..128        | 无     | C-按条件必填 | 通过MPI插件获取                                              |

## 返回数据

| 中文名称       | 英文名称           | 域类型         | 默认值 | 请求要求     | 备注                                                         |
| :------------- | :----------------- | :------------- | :----- | :----------- | :----------------------------------------------------------- |
| 查询流水号     | queryId            | AN20..21       | 无     | M-必填       | 被查询交易查询流水号                                         |
| 交易传输时间   | traceTime          | MMDDhhmmss     | 无     | M-必填       | 统一返回                                                     |
| 交易类型       | txnType            | N2             | 无     | M-必填       | 取值：同被查询交易                                           |
| 交易子类       | txnSubType         | N2             | 无     | M-必填       | 取值：同被查询交易                                           |
| 签名           | signature          | ANS1..1024     | 0      | M-必填       |                                                              |
| 签名方法       | signMethod         | N2             | 无     | M-必填       |                                                              |
| 清算币种       | settleCurrencyCode | AN3            | 无     | M-必填       | 资金类交易统一返回                                           |
| 清算金额       | settleAmt          | N1..12         | 无     | M-必填       | 资金类交易统一返回                                           |
| 清算日期       | settleDate         | MMDD           | 无     | M-必填       | 资金类交易统一返回                                           |
| 系统跟踪号     | traceNo            | N6             | 无     | M-必填       | 统一返回                                                     |
| 应答码         | respCode           | AN2            | 无     | M-必填       |                                                              |
| 应答信息       | respMsg            | ANS1..256      | 无     | M-必填       |                                                              |
| 兑换日期       | exchangeDate       | MMDD           | 无     | C-按条件必填 | 交易成功，交易币种和清算币种不一致的时候返回                 |
| 交易币种       | currencyCode       | AN3            | 无     | C-按条件必填 | EBPP上送的交易必须返回 其他可选                              |
| 交易金额       | txnAmt             | N1..12         | 无     | C-按条件必填 | EBPP上送的交易必须返回 其他可选                              |
| 签名公钥证书   | signPubKeyCert     | AN1..2048      | 无     | C-按条件必填 | 此域填写银联签名公钥证书，使用RSA签名方式时，默认返回，如果ctrlRule第五位为1时，不返。 |
| 清算汇率       | exchangeRate       | N8             | 无     | C-按条件必填 | 交易成功，交易币种和清算币种不一致的时候返回                 |
| 收单机构代码   | acqInsCode         | AN8..11        | 无     | C-按条件必填 |                                                              |
| 有卡交易信息域 | cardTransData      | ANS1Trans      | 无     | C-按条件必填 |                           |
| 原交易应答码   | origRespCode       | AN2            | 无     | C-按条件必填 | 查询交易成功时返回                                           |
| 原交易应答信息 | origRespMsg        | ANS1..256      | 无     | C-按条件必填 |                                                              |
| 账号           | accNo              | AN1..1024      | 无     | C-按条件必填 | 特殊商户需要时返回用户支付使用的卡号                         |
| 支付卡类型     | payCardType        | N2             | 无     | C-按条件必填 | （消费、预授权）特殊商户需要时返回，根据商户配置 00 借记卡 01 贷记卡 |
| 版本号         | version            | NS5            | 无     | R-需要返回   |                                                              |
| 编码方式       | encoding           | ANS1..20       | UTF-8  | R-需要返回   |                                                              |
| 产品类型       | bizType            | N6             | 无     | R-需要返回   |                                                              |
| 订单发送时间   | txnTime            | YYYYMMDDhhmmss | 无     | R-需要返回   | 被查询交易的交易时间                                         |
| 接入类型       | accessType         | N1             | 无     | R-需要返回   | 0：商户直连接入1：收单机构接入2：平台商户接入                |
| 商户代码       | merId              | AN15           | 无     | R-需要返回   |                                                              |
| 商户订单号     | orderId            | AN8..40        | 无     | R-需要返回   | 商户订单号，不能含“-”或“_”;商户自定义，同一交易日期内不可重复;商户代码merId、商户订单号orderId、订单发送时间txnTime三要素唯一确定一笔交易。 |
| 请求方保留域   | reqReserved        | ANS1..1024     | 无     | O-选填       | 返回被查询交易的请求方保留域                                 |

# 申请解约

无感支付解约，使用接入方签约时传入的”签约协议号”，通过此接口可发起无感支付解约。

> 阅读本文档之前请仔细阅读[云闪付小程序官方文档 - 申请解约](https://opentools.95516.com/applet/#/docs/develop/api-backend/payoff?id=_02040503)

## 接口调用

```php
/**
 * 申请解约
 * @param string $openId 用户唯一标识
 * @param string $contractId 申请签约完成后返回委托免密支付协议 id
 * @param string $planId 协议模板id由云闪付录入模板并分配给接入方
 * @param string $contractCode 接入方侧的签约协议号，由接入方自行生成
 */
$app->contract->relieve($openId = "", $contractId = "", $planId = "", $contractCode = "");

```

## 返回结果

| 序号 | 参数名        | 备注                            |
| ---- | ------------- | ------------------------------- |
| 1    | contractCode  | 接入方传来的签约协议号          |
| 2    | planId        | 接入方传来的协议模板id          |
| 3    | openId        | 用户唯一标识                    |
| 4    | operationTime | 操作时间,例:2021-08-24 10:34:43 |

## 解约通知

根据申请无感支付解约通知接口，用户在“云闪付APP-设置-支付设置-无感支付”入口下进行无感支付解 约, 解约完成通知接入方解约结果，特殊场景(公交地铁等脱机场景)不支持云闪付侧解约。

> 无感支付解约通知请求方式为 get 请求。

## 请求参数：

| 序号 | 参数名      | 是否必填 | 备注                                                         |
| ---- | ----------- | -------- | ------------------------------------------------------------ |
| 1    | appId       | 是       | 接入方的唯一标识                                             |
| 2    | timestamp   | 是       | 生成签名的时间戳                                             |
| 3    | nonceStr    | 是       | 生成签名的随机串                                             |
| 4    | operateTime | 是       | 操作时间                                                     |
| 5    | openId      | 是       | 用户唯一标识                                                 |
| 6    | trid        | 是       | 特定场景使用                                                 |
| 7    | contractId  | 是       | 签约成功后，云闪付返回的签约协议号，接入方凭此发起扣款，返回数据格式为 AN32 |
| 8    | signature   | 是       | 输出格式为 base64 ，请使用银联的公钥验证签名，参见附录五     |

## 返回参数：

| 序号 | 参数名 | 备注                                     |
| ---- | ------ | ---------------------------------------- |
| 1    | resp   | 成功接收通知以后发送 {"resp": "00"} 返回 |
